// test/bind9/named.conf
// BIND9 configuration for Snap DNS testing

options {
    directory "/var/cache/bind";

    // Listen on all interfaces
    listen-on { any; };
    listen-on-v6 { any; };

    // Allow queries from anywhere (test environment)
    allow-query { any; };

    // Allow zone transfers from the Snap DNS backend
    allow-transfer { 172.30.0.0/24; };

    // Disable recursion (we're authoritative only)
    recursion no;

    // DNSSEC validation
    dnssec-validation no;

    // Logging
    querylog yes;
};

// Include TSIG keys
include "/etc/bind/keys/tsig.key";

// Test zone: test.local
zone "test.local" {
    type master;
    file "/var/lib/bind/test.local.zone";
    allow-update { key "snap-dns-test-key"; };
    allow-transfer { 172.30.0.0/24; };
};

// Test zone: example.test
zone "example.test" {
    type master;
    file "/var/lib/bind/example.test.zone";
    allow-update { key "snap-dns-example-key"; };
    allow-transfer { 172.30.0.0/24; };
};

// Test zone: demo.local (no TSIG key - for testing key management)
zone "demo.local" {
    type master;
    file "/var/lib/bind/demo.local.zone";
    allow-update { key "snap-dns-demo-key"; };
    allow-transfer { 172.30.0.0/24; };
};

// Reverse DNS zone for testing
zone "0.30.172.in-addr.arpa" {
    type master;
    file "/var/lib/bind/0.30.172.in-addr.arpa.zone";
    allow-update { key "snap-dns-test-key"; };
    allow-transfer { 172.30.0.0/24; };
};

// Logging configuration
logging {
    channel default_log {
        stderr;
        severity info;
        print-time yes;
        print-category yes;
    };

    category default { default_log; };
    category queries { default_log; };
    category update { default_log; };
};
