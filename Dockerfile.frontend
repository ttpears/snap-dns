FROM node:20-slim

WORKDIR /app

# Install dependencies first
COPY package*.json ./
RUN npm install

# Development uses start.js script, production uses build and serve
CMD if [ "$NODE_ENV" = "production" ] ; \
    then \
    npm run build:prod && npm run serve:prod ; \
    else \
    node scripts/start.js ; \
    fi

# Install serve globally
RUN npm install -g serve

# Expose the port
EXPOSE ${PORT}

# Start the server using serve
CMD ["sh", "-c", "serve -s build -l ${PORT}"] 